---
import { AVAILABLE_LANGUAGES, DEFAULT_LANGUAGE } from '@shared/config/i18n';
import { getLangFromUrl } from '@shared/lib/i18n';

const url = new URL(Astro.request.url);
const currentLang = getLangFromUrl(url);
const pathname = url.pathname;

/**
 * Generates the correct path for language switching
 * Spanish (default): / or /page
 * English: /en/ or /en/page
 */
const getLanguagePath = (targetLang: string): string => {
	const cleanPath = pathname.replace(/^\/en(\/|$)/, '/');

	if (targetLang === DEFAULT_LANGUAGE) {
		return cleanPath === '' ? '/' : cleanPath;
	}

	// For English, add /en prefix
	if (cleanPath === '/' || cleanPath === '') {
		return '/en/';
	}

	return `/en${cleanPath}`;
};
---

<div
	class="flex items-center space-x-1 border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden"
>
	{
		AVAILABLE_LANGUAGES.map(lang => {
			const isActive = currentLang === lang;
			const path = isActive ? '#' : getLanguagePath(lang);

			return (
				<a
					href={path}
					class={`px-2 py-1 text-sm font-medium transition-colors ${
						isActive
							? 'bg-blue-500 text-white'
							: 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
					}`}
					aria-current={isActive ? 'page' : undefined}
				>
					{lang.toUpperCase()}
				</a>
			);
		})
	}
</div>
